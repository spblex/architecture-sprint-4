# Архитектурное решение по трейсингу

## Элементы системы для покрытия трейсингом
Трассировкой следует покрыть все пути между елементами системы, начиная от того где была иницирована активность до конечного элемента системы. 

Для трассировки используем уникальный идентификатор, который генерируем на входе (в месте инициации запроса) и передаем по цепочки вызовов. На каждом этапе логируем необходимую информацию использовав этот уникальный идентификатор.  
В нашем случае это:
* Internet Shop -> Shop API
* CRM -> CRM API -> Message Queue -> MES API -> Message Queue -> CRM API -> CRM
* MES -> MES API

Несмотря на то, что часть микросервисов содержит статику и будут выполняться в контексте браузера пользователя (Internet Shop, CRM, MES), в Java Script следует тоже генерировать идентификаор, который передавать на бэкенд. Для того чтобы можно было исследовать проблемы пользователей и связать их запросы из браузера с цепочкой вызовов на бэкенде.

## Мотивация
Внедрение трессинга позволит проследить полную цепочку вызовов, и выявить узкие и проблемные места в системе. 
Возможно будет понять какие элементы системы работают не эффективно, где происходят задержки. 
Это позволит решить проблему бизнеса связанную с невыполнением SLA по заказам. 

## Предлагаемое решение
Требуется внедрить трессинг в элементы системы перечисленные в разделе "Элементы системы для покрытия трейсингом", а именно:
* Internet Shop 
* Shop API
* CRM 
* CRM API
* MES
* MES API

Решение предлагается сделать на базе OpenTelemetry, как для микросервисов на Java и C#, так и использовать его в Vue и React. Подробнее см. [Exc3.drawio](Exc3.drawio)

## Компромиссы
Сохранение OTel идентификатора в базе данных с каждой записью кажется не целесообразным, т.к. связать цепочку вызовов с сохраненными данными будет возможно за счет логирования другой уникальной информации в микросервисах работающих с базой данных.
Cохранение идентификатора в S3 невозможно, т.к. стандарт не поддерживает сохранение метаданных. Но для каждой 3d модели в S3 система записывает метаданные в rdbms, таким образом можно связать полную цепочку вызовов с данными в S3.

## Безопасность
* Доступ к данным трейсинга будет предоставляться только внутри компании. 
* Для доступа нужно будет авторизоваться в системе трейсинга с ролью "Поддержка"
* В журнал трассировки не должны записываться чувствительные данные такие как пароль пользователя, номер счета и т.д.