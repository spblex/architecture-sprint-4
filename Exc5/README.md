# Архитектурное решение по кешированию

## Мотивация
Мы будем использовать комбинацию клиентского и серверного кэширования.

### Клиентское кэширование
Кэширование данных на стороне клиента (в браузере) позволит:
* Снизить нагрузку на бэкенд
* Не передавать повторно данные с бэкенда во фронтенд, если они не поменялись и соответственно не перерисовывать UI

### Серверное кэширование
Кэширование данных на стороне бэкенда позволит:
* Снизить нагрузку на базы данных
* Быстрее предоставлять доступ к часто используемым данным

## Предлагаемое решение

### Клиентское кэширование
* Internet Shop
  * Статичиские ресурсы: SPA-пакет, иконки, css-файлы и т.д. Учитывая, что команда работает 2х недельными спринтами, то и кэш мы будем устанавливать в 2 недели
    * Cache-Control: public, immutable, max-age=1209600
  * Список своих заказов - данные чувствительные поэтому не кэшируем их
    * Cache-Control: no-cache, no-store, must-revalidate
  * 3d Editor - данные 3d моделей будут храниться в локальном кэше. Чтобы отработать случай когда клиент обновил 3d модель с другого компьютера, будем отправлять If-Modified-Since 
    * Cache-Control: private, no-cahce
  * Список товаров - кэшируем данные, но с проверкой на сервере, отправляя If-Modified-Since
    * Cache-Control: private, no-cahce
  
* CRM
  * Статичиские ресурсы: SPA-пакет, иконки, css-файлы и т.д. Учитывая, что команда работает 2х недельными спринтами, то и кэш мы будем устанавливать в 2 недели
    * Cache-Control: public, immutable, max-age=1209600
  
* MES
  * Статичиские ресурсы: SPA-пакет, иконки, css-файлы и т.д. Учитывая, что команда работает 2х недельными спринтами, то и кэш мы будем устанавливать в 2 недели
    * Cache-Control: public, immutable, max-age=1209600
  * Список заказов - учитывая скорость прироста заказов кэшировать их нельзя
    * Cache-Control: no-cache, no-store, must-revalidate

### Серверное кэширование
* Shop API
  * Cache-Aside + Refresh-ahead - организуем кэш данных на базе Radis
    * Список заказов - предпочтительнее сохранение данных напрямую в базу во избежание их потери и т.к. данными пользуются другие сервисы 
    * Список товаров - учитываем, что запрашивая данные клиент отправляет If-Modified-Since заголовок в запросе
      * подошел бы вариант кэша Read-Through + Write-Behind, но он не подходит для "списка заказов", т.к. мы боимся потерять список, а использовать два подхода к кэширванию данных в рамках одного кэша - трудоемко и ресурсоемко
* CRM API
  * Список товаров - вместо прямого обращения к базе Shop DB, переключаемся на использование Shop API к которому уже подключили кэш
* MES API
  * Статусы заказов - так же как и в Shop API используем Cache-Aside + Refresh-ahead на базе Radis

Чтение списка заказов [ReadingOrdersSequence.puml](ReadingOrdersSequence.puml)

Изменение статуса заказа [UpdateOrederStateSeqence.puml](UpdateOrederStateSeqence.puml)