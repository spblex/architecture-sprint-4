# Выбор и настройка мониторинга в системе

## Мотивация
Необходимо внедрить мониторинг системы следующих уровней:
* Мониторинг системного уровеня позволит оценить утилизацию hardware ресурсов каждого микросервиса и эффективно перераспределить имеющиеся ресурсы между микросервисами. 
  * В случае выявления низкой общей утилизации ресурсов - это позволит высвободить излишние ресурсы тем самым сэкономив деньги бизнесу
  * В случае высокой утилизации ресурсов - станет понятно какие элементы системы следует отмасштабировать как горизонтально так и вертикально
  * Также с учетом постоянного прироста внешних клиентов, системный мониторинг позволит заблаговременно понять об приближении утилизации ресурсов к пороговым значениям
*  Метрики производительности позволят отслеживать общее состояние системы и заблаговременно реагировать на потенциальную деградацию производительности или частичный отказ в случае увеличения response time и error rate

## Выбор подхода к мониторингу
Для мониторинга разных частей системы будем использоваь разные подходы:
* Четыре золотых сигнала - используем для мониторинга следующих элементов системы:
  * Микросервис MES API
    * RPS
    * Number of simultanious sessions  
    * Number of HTTP 500
    * Response time (latency)
  * Очередь сообщений RabitMQ
    * Number of dead-letter-exchange letters
    * Number of message in flight
  * Базы данных
    * Number of connections
* RED - используем для мониторинга Веб-сервисов: MES, CRM, Internet Shop
  * RPS
  * Number of HTTP 500
  * Response time (latency)
* USE - используем для всех элементов системы включая базы даннх, очередь и микросервисы упомянутые выше
  * CPU %
  * Memory Utilisation
  * Size of S3
  * Size of db
  * Kb tranferred
  * Kb provided

## План действий
1. Развернуть и настроить Prometheus на сбор метрик
2. Развернуть и настроить Grafana
3. Настроить дашборды в Grafana
4. Настроить Alerting в Grafana

## Показатели насыщенности
В качестве порогового значения насыщенности выбираем три уровня:
* Желтый уровень - насыщеность проходит порог в 70 % микросервис горизонтально масшабируется (количество инстансов для масштабирования ограниченно)
* Оранжевый - насыщеность проходит порог в 80%, отправляется письмо и смс на группу быстрого реагирования
* Красный уровень (Авария) - насыщеность проходит порог в 95%, отправляется письмо, смс и производится автоматический телефонный звонок на группу быстрого реагирования с оповещением об аварии и необходимости подключиться в виртуальную конференс-комнату для устранения аварии 